; Screen Blood Enhanced - Stentorious

; Aux Vars

; "*ScrBld_INI"
; 0 = Visibility distance
; 1 = Heading angle
; 2 = Cooldown time
; 3 = Damage min
; 4 = Damage max
; 5 = Player POV
; 6 = Corpse

; "*ScrBld_SPL"
; 0 = Base splatter count
; 1 = Duration
; 2 = Projectile
; 3 = Melee
; 4 = Unarmed
; 5 = Limb dismembered
; 6 = Limb exploded
; 7 = Body exploded
; 8 = Restore IMOD

; On game load
Goo1.AuxVarSetFlt "*ScrBld_Timer" 0 0
Goo1.AuxVarSetFlt "*ScrBld_Timer" 0 1

; On game Restart
if eval Goo1.AuxVarGetFlt "*ScrBld_Init"
	return
endif
Goo1.AuxVarSetFlt "*ScrBld_Init" 1

; Check for requirements
if GetNVSEVersion > 5 && GetNVSERevision > 2 && GetNVSEBeta > 9
else
	MessageBoxEx "Screen Blood Enhanced missing requirement!%rInstall xNVSE 6.3.10+."
	return
endif
if GetPluginVersion "JohnnyGuitarNVSE" < 360
	MessageBoxEx "Screen Blood Enhanced missing requirement!%rInstall latest JohnnyGuitar NVSE plugin."
	return
endif
if GetPluginVersion "ShowOffNVSE Plugin" < 165
	MessageBoxEx "Screen Blood Enhanced missing requirement!%rInstall latest ShowOff NVSE plugin."
	return
endif

; Visibility settings
Goo1.AuxVarSetFlt "*ScrBld_INI" (GetMaxOf 0 ((GetINIFloat_Cached "Visibility:fDistance" "Stentorious\ScreenBloodEnhanced.ini") * 69.99104)) 0
Goo1.AuxVarSetFlt "*ScrBld_INI" (GetMaxOf 0 (GetINIFloat_Cached "Visibility:fHeadingAngle" "Stentorious\ScreenBloodEnhanced.ini")) 1
Goo1.AuxVarSetFlt "*ScrBld_INI" (GetMaxOf 0 (GetINIFloat_Cached "Visibility:fCooldown" "Stentorious\ScreenBloodEnhanced.ini")) 2
Goo1.AuxVarSetFlt "*ScrBld_INI" (GetMaxOf 0 (GetINIFloat_Cached "Visibility:fDamageMin" "Stentorious\ScreenBloodEnhanced.ini")) 3
Goo1.AuxVarSetFlt "*ScrBld_INI" (GetMaxOf (Goo1.AuxVarGetFlt "*ScrBld_INI" 3) (GetINIFloat_Cached "Visibility:fDamageMax" "Stentorious\ScreenBloodEnhanced.ini")) 4
Goo1.AuxVarSetFlt "*ScrBld_INI" (GetMaxOf 0 (GetMinOf 2 (GetINIFloat_Cached "Visibility:iPOV" "Stentorious\ScreenBloodEnhanced.ini"))) 5
Goo1.AuxVarSetFlt "*ScrBld_INI" (eval GetINIFloat_Cached "Visibility:bCorpse" "Stentorious\ScreenBloodEnhanced.ini") 6

; Splatter settings
Goo1.AuxVarSetFlt "*ScrBld_SPL" (GetMaxOf 0 (GetINIFloat_Cached "BloodSplatter:iSplatterCount" "Stentorious\ScreenBloodEnhanced.ini")) 0
Goo1.AuxVarSetFlt "*ScrBld_SPL" (GetMaxOf 0 (GetINIFloat_Cached "BloodSplatter:fDuration" "Stentorious\ScreenBloodEnhanced.ini")) 1
Goo1.AuxVarSetFlt "*ScrBld_SPL" (GetMaxOf 0 (GetINIFloat_Cached "BloodSplatter:fProjectile" "Stentorious\ScreenBloodEnhanced.ini")) 2
Goo1.AuxVarSetFlt "*ScrBld_SPL" (GetMaxOf 0 (GetINIFloat_Cached "BloodSplatter:fMelee" "Stentorious\ScreenBloodEnhanced.ini")) 3
Goo1.AuxVarSetFlt "*ScrBld_SPL" (GetMaxOf 0 (GetINIFloat_Cached "BloodSplatter:fUnarmed" "Stentorious\ScreenBloodEnhanced.ini")) 4
Goo1.AuxVarSetFlt "*ScrBld_SPL" (GetMaxOf 0 (GetINIFloat_Cached "BloodSplatter:fLimbDismembered" "Stentorious\ScreenBloodEnhanced.ini")) 5
Goo1.AuxVarSetFlt "*ScrBld_SPL" (GetMaxOf 0 (GetINIFloat_Cached "BloodSplatter:fLimbExploded" "Stentorious\ScreenBloodEnhanced.ini")) 6
Goo1.AuxVarSetFlt "*ScrBld_SPL" (GetMaxOf 0 (GetINIFloat_Cached "BloodSplatter:fBodyExploded" "Stentorious\ScreenBloodEnhanced.ini")) 7
Goo1.AuxVarSetFlt "*ScrBld_SPL" (eval GetINIFloat_Cached "BloodSplatter:bRestoreIMOD" "Stentorious\ScreenBloodEnhanced.ini") 8

; Mod support settings
Goo1.AuxVarSetFlt "*ScrBld_MOD" (GetMaxOf 0 (GetINIFloat_Cached "ModSupport:fHelmetOverlay" "Stentorious\ScreenBloodEnhanced.ini")) 0
Goo1.AuxVarSetFlt "*ScrBld_MOD" (GetMaxOf 0 (GetINIFloat_Cached "ModSupport:fModernNightVision" "Stentorious\ScreenBloodEnhanced.ini")) 1

CloseFileSO "Stentorious\ScreenBloodEnhanced.ini" 0

; Event handlers
SetOnHitEventHandler (CompileScript "ScreenBloodEnhanced\OnHit.gek") 1
